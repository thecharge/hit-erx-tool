"use strict";angular.module("xml",[]),angular.module("hl7v2",[]),angular.module("edi",[]),angular.module("commonServices",[]),angular.module("common",["ngResource","my.resource","xml","hl7v2","edi"]),angular.module("cf",["common"]),angular.module("doc",["common"]),angular.module("cb",["common"]),angular.module("hit-tool-directives",[]),angular.module("hit-tool-services",["common"]);var app=angular.module("hit-tool",["ngRoute","ui.bootstrap","ngCookies","LocalStorageModule","ngResource","ngSanitize","ngAnimate","ui.bootstrap","angularBootstrapNavTree","QuickList","xml","hl7v2","edi","cf","cb","ngTreetable","blueimp.fileupload","hit-tool-directives","hit-tool-services","commonServices","smart-table","hit-profile-viewer","hit-validation-result","hit-vocab-search","hit-report-viewer","hit-testcase-viewer","hit-testcase-tree","hit-doc","doc"]);app.config(["$routeProvider","$httpProvider","localStorageServiceProvider",function(a,b,c){c.setPrefix("hit-tool").setStorageType("sessionStorage"),a.when("/",{templateUrl:"views/home.html"}).when("/home",{templateUrl:"views/home.html"}).when("/testing",{templateUrl:"../views/templates.html"}).when("/doc",{templateUrl:"views/doc.html"}).when("/setting",{templateUrl:"views/setting.html"}).when("/about",{templateUrl:"views/about.html"}).when("/contact",{templateUrl:"views/contact.html"}).when("/cf",{templateUrl:"views/cf/testing.html"}).when("/cb",{templateUrl:"views/cb/testing.html"}).otherwise({redirectTo:"/"})}]),app.run(["$rootScope","$location","$modal","TestingSettings","AppInfo","StorageService","$route","$window",function(a,b,c,d,e,f,g,h){a.appInfo={},a.stackPosition=0,(new e).then(function(b){a.appInfo=b}),a.$watch(function(){return b.path()},function(b,c){if(a.activePath===b){var d,e=h.history.state;d=!!(e&&e.position<=a.stackPosition),d?a.stackPosition--:a.stackPosition++}else g.current&&(h.history.replaceState({position:a.stackPosition},""),a.stackPosition++)}),a.isActive=function(b){return b===a.activePath},a.setActive=function(c){""===c||"/"===c?b.path("/home"):a.activePath=c},a.isSubActive=function(b){return b===a.subActivePath},a.setSubActive=function(b){a.subActivePath=b,f.set(f.ACTIVE_SUB_TAB_KEY,b)},a.showError=function(b){var d=c.open({templateUrl:"ErrorDlgDetails.html",controller:"ErrorDetailsCtrl",resolve:{error:function(){return b}}});d.result.then(function(b){a.error=b},function(){})},a.cutString=function(a){return a.length>20&&(a=a.substring(0,20)+"..."),a},a.tabs=new Array,a.selectTestingType=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.tabs[4]=!1,a.tabs[5]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0,d.setActiveTab(a.activeTab)},a.downloadArtifact=function(a){var b=document.createElement("form");b.action="api/testartifact/download",b.method="POST",b.target="_target";var c=document.createElement("input");c.name="path",c.value=a,b.appendChild(c),b.style.display="none",document.body.appendChild(b),b.submit()},a.toHTML=function(a){return $sce.trustAsHtml(a)},a.compile=function(a){return $compile(a)},a.$on("$locationChangeSuccess",function(){a.setActive(b.path())})}]),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(a,b,c,d){}]).directive("carousel",[function(){return{}}]),angular.module("hit-tool-services").factory("TabSettings",["$rootScope",function(a){return{"new":function(a){return{key:a,activeTab:0,getActiveTab:function(){return this.activeTab},setActiveTab:function(a){this.activeTab=a,this.save()},save:function(){sessionStorage.setItem(this.key,this.activeTab)},restore:function(){this.activeTab=null!=sessionStorage.getItem(this.key)&&""!=sessionStorage.getItem(this.key)?parseInt(sessionStorage.getItem(this.key)):0}}}}}]),app.controller("ErrorDetailsCtrl",["$scope","$modalInstance","error",function(a,b,c){a.error=c,a.ok=function(){b.close(a.error)},a.cancel=function(){b.dismiss("cancel")}}]),app.directive("stRatio",function(){return{link:function(a,b,c){var d=+c.stRatio;b.css("width",d+"%")}}}),angular.module("hit-tool-services").factory("AppInfo",["$http","$q",function(a,b){return function(){var c=b.defer();return a.get("api/appInfo").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("hit-tool-services").controller("TableFoundCtrl",["$scope","$modalInstance","table",function(a,b,c){a.table=c,a.tmpTableElements=[].concat(null!=c?c.valueSetElements:[]),a.cancel=function(){b.dismiss("cancel")}}]),angular.module("my.resource",["ngResource"]).factory("Resource",["$resource",function(a){return function(b,c,d){var e={update:{method:"put",isArray:!1},create:{method:"post"}};d=angular.extend(e,d);var f=a(b,c,d);return f.prototype.$save=function(a,b){return this.id?this.$update(a,b):this.$create(a,b)},f}}]),angular.module("hit-tool-services").factory("TestingSettings",["$rootScope",function(a){var b={activeTab:0,getActiveTab:function(){return b.activeTab},setActiveTab:function(a){b.activeTab=a,b.save()},save:function(){sessionStorage.TestingActiveTab=b.activeTab},restore:function(){b.activeTab=null!=sessionStorage.TestingActiveTab&&""!=sessionStorage.TestingActiveTab?parseInt(sessionStorage.TestingActiveTab):0}};return b}]),angular.module("xml").factory("XmlParser",["$http","$q",function(a,b){return function(c){var d=b.defer(),e=angular.fromJson({content:c});return a.post("api/xml/parse",e,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise}}]),angular.module("xml").factory("XmlFormatter",["$http","$q",function(a,b){return function(c){var d=b.defer(),e=angular.fromJson({content:c});return a.post("api/xml/format",e,{timeout:6e4}).then(function(a){d.resolve(a.data.content)},function(a){d.reject(a.data)}),d.promise}}]),angular.module("xml").factory("XmlNodeFinder",["$rootScope",function(a){return{find:function(a,b){var c=a.get_first_branch(),d=a.get_siblings(c);if(d){var e=d[0];return null==e?null:this.findNode(a,e,b.line)}return null},findNode:function(a,b,c){if(b.data.start.line<=c){if(b.data.start.line==c||b.data.end.line==c)return b;var d=a.get_children(b);if(d&&d.length>0)for(var e=0;e<d.length;e++){var f=this.findNode(a,d[e],c);if(null!=f)return f}}return null}}}]),angular.module("xml").factory("XmlCursorUtils",["$rootScope",function(a){return{createCoordinate:function(a,b){try{return angular.fromJson({start:a,end:b})}catch(c){}}}}]),angular.module("xml").factory("XmlEditorUtils",["$rootScope","$http","$q",function(a,b,c){return{select:function(a,b){b.doc.setSelection({line:a.start.line-1,ch:a.start.index},{line:a.end.line-1,ch:a.end.index})},isXML:function(a){return a.startsWith("<")}}}]),angular.module("xml").factory("XmlTreeUtils",["$rootScope","$http","$q","XmlNodeFinder","XmlCursorUtils",function(a,b,c,d,e){return{selectNode:function(a,b){var c=d.find(a,b);if(null!==c){var e=a.get_selected_branch();e!==c&&(a.collapse_all(),a.select_branch(c),a.expand_branch(c),b.start=c.data.start,b.end=c.data.end)}},getCoordinate:function(a){return e.createCoordinate(a.data.start,a.data.end)},setCoordinate:function(a,b){try{var c=this.getCoordinate(a);null!==c&&(b.start=c.start,b.end=c.end,b.notify())}catch(d){}},expandTree:function(a){if(a){var b=a.get_first_branch(),c=a.get_siblings(b);if(c)for(var d=0;d<c.length;d++){var e=c[d];a.expand_branch(e);for(var f=a.get_children(e),g=0;g<f.length;g++){var h=f[g];a.expand_branch(h);for(var i=a.get_children(h),j=0;j<i.length;j++){var k=i[j];a.expand_branch(k)}}}}}}}]),angular.module("xml").factory("XMLMessageValidator",["$http","$q",function(a,b){return{validate:function(c,d,e,f){var g=b.defer();return a.post("api/xml/testcontext/"+c+"/validateMessage",angular.fromJson({content:d,contextType:f})).then(function(a){try{g.resolve(angular.fromJson(a.data))}catch(b){g.reject("Invalid character in the message")}},function(a){g.reject(a.data)}),g.promise}}}]),angular.module("xml").factory("XMLMessageParser",["$http","$q",function(a,b){return{parse:function(c,d,e){var f=b.defer();return a.post("api/xml/testcontext/"+c+"/parseMessage",angular.fromJson({content:d})).then(function(a){f.resolve(angular.fromJson(a.data))},function(a){f.reject(a.data)}),f.promise}}}]),angular.module("cf").factory("CF",["$rootScope","$http","$q","Editor","EDICursor","Message","Tree",function(a,b,c,d,e,f,g){var h={editor:new d,cursor:new e,tree:new g,testCase:null,selectedTestCase:null,message:new f,searchTableId:0};return h}]),angular.module("cf").factory("CFTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/cf/testcases",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("cb").factory("CB",["$http","$q","Editor","EDICursor","Message","ValidationSettings","Tree",function(a,b,c,d,e,f,g){var h={testCase:null,selectedTestCase:null,editor:new c,tree:new g,cursor:new d,message:new e,validationSettings:new f,setContent:function(a){h.message.content=a,h.editor.instance.doc.setValue(a),h.message.notifyChange()},getContent:function(){return h.message.content}};return h}]),angular.module("cb").factory("CBTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/cb/testcases").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("hl7v2").factory("HL7CursorUtils",["$rootScope","$http","$q","HL7EditorUtils",function(a,b,c,d){return{getCoordinate:function(a){try{if(null!=a){var b=d.getSeparators(),c=a.doc.getCursor(!0),e=c.ch,f=a.doc.getLine(c.line),g=f.toString().split(""),h=e-1,i=e;if(0==b.length)return;for(;h>0&&-1===$.inArray(g[h],b);)h--;for(;i<g.length&&-1===$.inArray(g[i],b);)i++;return this.createCoordinate(c.line+1,h+1,i,e)}}catch(j){}},createCoordinate:function(a,b,c,d,e){try{return angular.fromJson({line:a,startIndex:b,endIndex:c,index:d,triggerTree:e})}catch(f){}},getStartIndex:function(a,b){if(a>=0){for(var c=0,d=0,e=null;a>=c;)e=b[c],""===e?d+=1:d=d+e.length+1,c++;return d}return 0}}}]),angular.module("hl7v2").factory("HL7EditorUtils",["$rootScope","$http","$q",function(a,b,c){return{getSeparators:function(){return["|","^","&","~"]},getSeparatorsMap:function(a,b){var c=this.getSeparators(),d=new Array(4);return d.field_separator=c[0],d.component_separator=c[1],d.subcomponent_separator=c[2],d.continuation_separator=c[3],d},select:function(a,b){var c=b.startIndex,d=b.endIndex,e=b.line;if(null!==c&&null!==d&&c>=0&&d>=0){var e=parseInt(e)-1;a.doc.setSelection({line:e,ch:c},{line:e,ch:d}),a.scrollIntoView({line:e,ch:c},{line:e,ch:d})}},isHL7:function(a){return a.startsWith("MSH")}}}]),angular.module("hl7v2").factory("HL7Utils",function(){return{getPosition:function(a,b){try{switch(b){case"SEGMENT":return 1;case"FIELD":return a.split("-")[1].split("[")[0];case"COMPONENT":return a.split(".")[1];case"SUB_COMPONENT":return a.split(".")[2]}}catch(c){return 0}},getInstanceNumber:function(a,b){try{switch(b){case"SEGMENT":return a.split("[")[1].split("]")[0];case"FIELD":return a.split("-")[1].split("[")[1].split("]")[0];case"COMPONENT":return 1;case"SUB_COMPONENT":return 1}}catch(c){return 1}},getType:function(a){if(!(a.indexOf("-")>0))return"SEGMENT";var a=a.split("-")[1];if(0===a.split(".").length)return"FIELD";if(1===a.split(".").length)return"COMPONENT";if(2===a.split(".").length)return"SUB_COMPONENT";throw new Error("Invalid Path "+a)},prettyPath:function(a){return a.replace(/\[[^\]]*?\]/g,"")}}}),angular.module("hl7v2").factory("HL7TreeUtils",["$rootScope","$http","$q","HL7CursorUtils","HL7Utils",function(a,b,c,d,e){return{findByIndex:function(a,b,c){var d=this.findNodeByLineNumber(a,b.line);return void 0==d||null==d?null:this.findNodeByIndex(a,d,b.line,b.startIndex+1,b.endIndex+1,c)},findByPath:function(a,b,c){var d=this.findNodeByLineNumber(a,b);return void 0==d||null==d?null:this.findNodeByPath(a,d,b,c)},findNodeByPath:function(a,b,c,d){if(d.startsWith(b.data.path)){if(angular.equals(b.data.path,d))return b;var e=a.get_children(b);if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=this.findNodeByPath(a,e[f],c,d);if(null!=g)return g}}return null},findLastChild:function(a,b){var c=a.get_children(b);if(!(c&&c.length>0))return b;for(var d=0;d<c.length;d++)return this.findLastChild(a,c[d])},findNodeByIndex:function(a,b,c,d,e,f){if(b.data.lineNumber<=c){var g=this.getEndIndex(b,f);if(angular.equals(b.data.startIndex,d)&&angular.equals(g,e))return this.findLastChild(a,b);var h=a.get_children(b);if(h&&h.length>0)for(var i=0;i<h.length;i++){var j=this.findNodeByIndex(a,h[i],c,d,e,f);if(null!=j)return j}}return null},findNodeByLineNumber:function(a,b){if(void 0!=a){var c=a.get_first_branch(),d=a.get_siblings(c);if(d){if(1===b)return c;if(b<=d.length)return d[b-1]}}return null},selectNodeByIndex:function(a,b,c){var d=this.findByIndex(a,b,c);if(null!==d){var e=a.get_selected_branch();e!==d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}return d},selectNodeByPath:function(a,b,c){var d=this.findByPath(a,b,c);if(null!==d){var e=a.get_selected_branch();e!==d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}return d},getStringValue:function(a,b,c){var d=e.getPosition(b,a),f=e.getInstanceNumber(b,a);switch(a){case"SEGMENT":return c.replace("\r","");case"FIELD":if(c.startsWith("MSH")&&1==d)return"";var g=c.startsWith("MSH")?d-2:d-1,h=c.substring(4).split("|");return(f>1?h[g].split("~")[f-1]:h[g]).replace("\r","");case"COMPONENT":var h=this.getStringValue("FIELD",b,c);return(f>1?h.split("^")[d-1].split("~")[f-1]:h.split("^")[d-1]).replace("\r","");case"SUB_COMPONENT":var h=this.getStringValue("COMPONENT",b,c),i=h.split("&");return(f>1?i[d-1].split("~")[f-1]:i[d-1]).replace("\r","")}},getEndIndex:function(a,b){try{var c=a.data;return void 0!=c.endIndex&&-1!=c.endIndex?c.endIndex:this.getEndColumn(c.lineNumber,c.startIndex,c.type,c.path,b)}catch(d){return-1}},getEndColumn:function(a,b,c,d,e){try{var f=1==e.toString().split("\n").length?e.toString().split("\r"):e.toString().split("\n");return a-1<f.length?null==f[a-1]||angular.equals("",f[a-1].toString().trim())?-1:b+this.getStringValue(c,d,f[a-1]).length:-1}catch(g){return-1}}}}]),angular.module("hl7v2").factory("HL7V2MessageValidator",["$http","$q","HL7EditorUtils",function(a,b,c){return{validate:function(d,e,f,g){var h=b.defer();return c.isHL7(e)?a.post("api/hl7v2/testcontext/"+d+"/validateMessage",angular.fromJson({content:e,contextType:g})).then(function(a){try{h.resolve(angular.fromJson(a.data))}catch(b){h.reject("Invalid character in the message")}},function(a){h.reject(a.data)}):h.reject("Message provided is not an HL7 v2 message"),h.promise}}}]),angular.module("hl7v2").factory("HL7V2MessageParser",["$http","$q","HL7EditorUtils",function(a,b,c){return{parse:function(d,e,f){var g=b.defer();return c.isHL7(e)?a.post("api/hl7v2/testcontext/"+d+"/parseMessage",angular.fromJson({content:e})).then(function(a){g.resolve(angular.fromJson(a.data))},function(a){g.reject(a.data)}):g.reject("Message provided is not an HL7 v2 message"),g.promise}}}]),angular.module("edi").factory("EDICursorUtils",["$rootScope","$http","$q","EDIEditorUtils",function(a,b,c,d){return{getCoordinate:function(a){try{if(null!=a){var b=d.getSeparators(),c=a.doc.getCursor(!0),e=c.ch,f=a.doc.getLine(c.line),g=f.toString().split(""),h=e-1,i=e;if(0==b.length)return;for(;h>0&&-1===$.inArray(g[h],b);)h--;for(;i<g.length&&-1===$.inArray(g[i],b);)i++;return this.createCoordinate(c.line+1,h+1,i,e)}}catch(j){}},createCoordinate:function(a,b,c,d,e){try{return angular.fromJson({line:a,startIndex:b,endIndex:c,index:d,triggerTree:e})}catch(f){}},getStartIndex:function(a,b){if(a>=0){for(var c=0,d=0,e=null;a>=c;)e=b[c],""===e?d+=1:d=d+e.length+1,c++;return d}return 0}}}]),angular.module("edi").factory("EDIEditorUtils",["$rootScope","$http","$q",function(a,b,c){return{getSeparators:function(){return["|","^","&","~"]},getSeparatorsMap:function(a,b){var c=this.getSeparators(),d=new Array(4);return d.field_separator=c[0],d.component_separator=c[1],d.subcomponent_separator=c[2],d.continuation_separator=c[3],d},select:function(a,b){var c=b.startIndex,d=b.endIndex,e=b.line;if(null!==c&&null!==d&&c>=0&&d>=0){var e=parseInt(e)-1;a.doc.setSelection({line:e,ch:c},{line:e,ch:d}),a.scrollIntoView({line:e,ch:c},{line:e,ch:d})}},isEDI:function(a){return!0}}}]),angular.module("edi").factory("EDIUtils",function(){return{getPosition:function(a,b){try{switch(b){case"SEGMENT":return 1;case"FIELD":return a.split("-")[1].split("[")[0];case"COMPONENT":return a.split(".")[1];case"SUB_COMPONENT":return a.split(".")[2]}}catch(c){return 0}},getInstanceNumber:function(a,b){try{switch(b){case"SEGMENT":return a.split("[")[1].split("]")[0];case"FIELD":return a.split("-")[1].split("[")[1].split("]")[0];case"COMPONENT":return 1;case"SUB_COMPONENT":return 1}}catch(c){return 1}},getType:function(a){if(!(a.indexOf("-")>0))return"SEGMENT";var a=a.split("-")[1];if(0===a.split(".").length)return"FIELD";if(1===a.split(".").length)return"COMPONENT";if(2===a.split(".").length)return"SUB_COMPONENT";throw new Error("Invalid Path "+a)},prettyPath:function(a){return a.replace(/\[[^\]]*?\]/g,"")}}}),angular.module("edi").factory("EDITreeUtils",["$rootScope","$http","$q","EDICursorUtils","EDIUtils",function(a,b,c,d,e){return{findByIndex:function(a,b,c){var d=this.findNodeByLineNumber(a,b.line);return void 0==d||null==d?null:this.findNodeByIndex(a,d,b.line,b.startIndex+1,b.endIndex+1,c)},findByPath:function(a,b,c){var d=this.findNodeByLineNumber(a,b);return void 0==d||null==d?null:this.findNodeByPath(a,d,b,c)},findNodeByPath:function(a,b,c,d){if(d.startsWith(b.data.path)){if(angular.equals(b.data.path,d))return b;var e=a.get_children(b);if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=this.findNodeByPath(a,e[f],c,d);if(null!=g)return g}}return null},findLastChild:function(a,b){var c=a.get_children(b);if(!(c&&c.length>0))return b;for(var d=0;d<c.length;d++)return this.findLastChild(a,c[d])},findNodeByIndex:function(a,b,c,d,e,f){if(b.data.lineNumber<=c){var g=this.getEndIndex(b,f);if(angular.equals(b.data.startIndex,d)&&angular.equals(g,e))return this.findLastChild(a,b);var h=a.get_children(b);if(h&&h.length>0)for(var i=0;i<h.length;i++){var j=this.findNodeByIndex(a,h[i],c,d,e,f);if(null!=j)return j}}return null},findNodeByLineNumber:function(a,b){if(void 0!=a){var c=a.get_first_branch(),d=a.get_siblings(c);if(d){if(1===b)return c;if(b<=d.length)return d[b-1]}}return null},selectNodeByIndex:function(a,b,c){var d=this.findByIndex(a,b,c);if(null!==d){var e=a.get_selected_branch();e!==d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}return d},selectNodeByPath:function(a,b,c){var d=this.findByPath(a,b,c);if(null!==d){var e=a.get_selected_branch();e!==d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}return d},getStringValue:function(a,b,c){var d=e.getPosition(b,a),f=e.getInstanceNumber(b,a);switch(a){case"SEGMENT":return c.replace("\r","");case"FIELD":if(c.startsWith("MSH")&&1==d)return"";var g=c.startsWith("MSH")?d-2:d-1,h=c.substring(4).split("|");return(f>1?h[g].split("~")[f-1]:h[g]).replace("\r","");case"COMPONENT":var h=this.getStringValue("FIELD",b,c);return(f>1?h.split("^")[d-1].split("~")[f-1]:h.split("^")[d-1]).replace("\r","");case"SUB_COMPONENT":var h=this.getStringValue("COMPONENT",b,c),i=h.split("&");return(f>1?i[d-1].split("~")[f-1]:i[d-1]).replace("\r","")}},getEndIndex:function(a,b){try{var c=a.data;return void 0!=c.endIndex&&-1!=c.endIndex?c.endIndex:this.getEndColumn(c.lineNumber,c.startIndex,c.type,c.path,b)}catch(d){return-1}},getEndColumn:function(a,b,c,d,e){try{var f=1==e.toString().split("\n").length?e.toString().split("\r"):e.toString().split("\n");return a-1<f.length?null==f[a-1]||angular.equals("",f[a-1].toString().trim())?-1:b+this.getStringValue(c,d,f[a-1]).length:-1}catch(g){return-1}}}}]),angular.module("edi").factory("EDIMessageValidator",["$http","$q","EDIEditorUtils",function(a,b,c){return{validate:function(d,e,f,g){if(c.isEDI(e)){var h=b.defer();a.post("api/edi/testcontext/"+d+"/validateMessage",angular.fromJson({content:e,contextType:g})).then(function(a){try{h.resolve(angular.fromJson(a.data))}catch(b){h.reject("Invalid character in the message")}},function(a){h.reject(a.data)})}else h.reject("Message provided is not an EDI message");return h.promise}}}]),angular.module("edi").factory("EDIMessageParser",["$http","$q","EDIEditorUtils",function(a,b,c){return{parse:function(d,e,f){var g=b.defer();return c.isEDI(e)?a.post("api/edi/testcontext/"+d+"/parseMessage",angular.fromJson({content:e})).then(function(a){g.resolve(angular.fromJson(a.data))},function(a){g.reject(a.data)}):g.reject("Message provided is not an EDI message"),g.promise}}}]),angular.module("commonServices").factory("TestContext",["$http","$q",function(a,b){var c=function(){this.id=null};return c.prototype.init=function(a){this.id=a.id},c.prototype.clear=function(){this.id=null},c}]),angular.module("commonServices").factory("Editor",["$http","$q",function(a,b){var c=function(){this.instance=null,this.updateIndicator="0",this.id=null,this.name=""};return c.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},c.prototype.init=function(a){void 0!=a&&(this.instance=a)},c.prototype.getContent=function(){return void 0!=this.instance?this.instance.doc.getValue():null},c.prototype.setContent=function(a){void 0!=this.instance&&(this.instance.doc.setValue(a),this.notifyChange())},c}]),angular.module("commonServices").factory("XmlEditor",["Editor",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.format=function(){this.instance.doc.setValue(this.instance.doc.getValue().replace(/\n/g,"").replace(/[\t ]+\</g,"<").replace(/\>[\t ]+\</g,"><").replace(/\>[\t ]+$/g,">"));var a=this.instance.lineCount(),b=this.instance.getTextArea().value.length;this.instance.autoFormatRange({line:0,ch:0},{line:a,ch:b})},b}]),angular.module("commonServices").factory("EDICursor",function(){var a=function(){this.line=1,this.startIndex=-1,this.endIndex=-1,this.index=-1,this.segment="",this.updateIndicator="0",this.triggerTree=void 0};return a.prototype.init=function(a,b,c,d,e){this.line=a,this.startIndex=b,this.endIndex=c,this.index=d,this.triggerTree=e,this.notify()},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("XmlCursor",function(){var a=function(){this.line=-1,this.start={line:1,index:-1},this.end={line:1,index:-1},this.updateIndicator="0"};return a.prototype.setLine=function(a){this.line=a,this.notify()},a.prototype.toString=function(a){return this.line+","+this.start+","+this.end},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("ValidationResultItem",function(){var a=function(){this.data=[],this.categories=[],this.categories.push({title:"All",data:[]}),this.show=!0,this.updateIndicator="0"};return a.prototype.init=function(a){this.data=a,this.categories=[],this.categories.push({title:"All",data:[]}),this.show=!0,this.notify()},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("ValidationSettings",function(){var a=function(){this.errors=!0,this.affirmatives=!0,this.ignores=!0,this.alerts=!0,this.warnings=!0};return a}),angular.module("commonServices").factory("ValidationResult",["ValidationResultItem","$q",function(a,b){var c=function(b){this.key=b,this.xml="",this.errors=new a,this.affirmatives=new a,this.ignores=new a,this.alerts=new a,this.warnings=new a,this.informationals=new a,this.id=""};return c.prototype.updateId=function(){this.id=(new Date).getTime()},c.prototype.clear=function(){this.xml="",this.errors=new a,this.affirmatives=new a,this.ignores=new a,this.alerts=new a,this.warnings=new a,this.informationals=new a,this.updateId()},c.prototype.init=function(a){this.xml=a.xml,this.errors.init(a.errors),this.affirmatives.init(a.affirmatives),this.ignores.init(a.ignores),this.alerts.init(a.alerts),this.warnings.init(a.warnings),this.informationals.init(a.informationals),this.updateId()},c.prototype.saveState=function(){sessionStorage.setItem(this.key,this.content)},c.prototype.restoreState=function(){this.content=sessionStorage.getItem(this.key)},c.prototype.hasState=function(){return sessionStorage.getItem(this.key)!=={xml:""}&&null!=sessionStorage.getItem(this.key)},c.prototype.getState=function(){return sessionStorage.getItem(this.key)},c.prototype.getContent=function(){return this.content},c.prototype.setContent=function(a){this.content=a},c}]),angular.module("commonServices").factory("DQAValidationResult",function(){var a=function(a){this.errors=[],this.warnings=[];for(var b=0;b<a.issuesList.length;b++){var c=a.issuesList[b];"Error"===c.type?this.errors.push(c):this.warnings.push(c)}};return a}),angular.module("commonServices").factory("Profile",["$http","$q",function(a,b){var c=function(){this.id=null,this.xml="",this.json="",this.name=[],this.description=""};return c.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},c.prototype.init=function(a){this.id=a.id,this.xml=a.xml,this.json=null,this.name=a.name,this.description=a.description},c.prototype.clear=function(){this.id=null,this.xml=null,this.json=null,this.name=null,this.description=null},c}]),angular.module("commonServices").factory("Message",["$http","$q",function(a,b){var c=function(){this.id=null,this.name="",this.content="",this.description="",this.updateIndicator="0"};return c.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},c.prototype.setContent=function(a){this.content=void 0!=a?a:"",this.notifyChange()},c.prototype.init=function(a){this.id=a.id,this.name=a.name,this.description=a.description,this.setContent(a.content)},c.prototype.download=function(){var a=document.createElement("form");a.action="api/message/download",a.method="POST",a.target="_target";var b=document.createElement("textarea");b.name="content",b.value=this.content,a.appendChild(b),a.style.display="none",document.body.appendChild(a),a.submit()},c}]),angular.module("commonServices").factory("Tree",function(){var a=function(){this.id=null,this.root={}};return a}),angular.module("commonServices").factory("Report",["$http","$q",function(a,b){var c=function(){this.html=null};return c.prototype.generate=function(c,d){var e=b.defer();return a({url:c,data:$.param({xmlReport:d}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){e.resolve(angular.fromJson(a))}).error(function(a){e.reject(a)}),e.promise},c.prototype.download=function(a,b){var c=document.createElement("form");c.action=a,c.method="POST",c.target="_target";var d=document.createElement("textarea");d.name="xmlReport",d.value=b,c.appendChild(d),c.style.display="none",document.body.appendChild(c),c.submit()},c}]),angular.module("commonServices").factory("DataInstanceReport",["$http","NewValidationReport",function(a,b){var c=function(){b.call(this,arguments)};return c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.generateByFormat=function(a,b){return this.generate("api/report/generateAs/"+b,a)},c.prototype.downloadByFormat=function(a,b){return this.generate("api/report/downloadAs/"+b,a)},c}]),angular.module("commonServices").factory("NewValidationReport",["$http","$q",function(a,b){var c=function(){this.content={metaData:{},result:{}}};return c.prototype.download=function(a){var b=document.createElement("form");b.action=a,b.method="POST",b.target="_target";var c=document.createElement("textarea");c.name="jsonReport",c.value=this.content,b.appendChild(c),b.style.display="none",document.body.appendChild(b),b.submit()},c.prototype.generate=function(c){var d=b.defer();return a({url:c,data:$.param({jsonReport:this.content}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){d.resolve(angular.fromJson(a))}).error(function(a){d.reject(a)}),d.promise},c}]),angular.module("commonServices").factory("Logger",function(){var a=function(){this.content=""};return a.prototype.log=function(a){this.content=this.content+"\n"+this.getCurrentTime()+":"+a},a.prototype.clear=function(){this.content=""},a.prototype.init=function(){this.clear()},a.prototype.getCurrentTime=function(){var a=new Date;return(a.getMonth()+1<10?"0":"")+(a.getMonth()+1)+"/"+(a.getDate()<10?"0":"")+a.getDate()+"/"+a.getFullYear()+" - "+(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes()+":"+(a.getSeconds()<10?"0":"")+a.getSeconds()},a}),angular.module("commonServices").factory("Endpoint",function(){var a=function(){this.value=null},a=function(a){this.value=a};return a}),angular.module("commonServices").factory("SecurityFaultCredentials",["$q","$http",function(a,b){var c=function(){this.username=null,this.password=null};return c.prototype.init=function(a,b){this.username=a,this.password=b},c}]),angular.module("commonServices").factory("Clock",["$interval",function(a){var b=function(a){this.value=void 0,this.intervl=a};return b.prototype.start=function(b){angular.isDefined(this.value)&&this.stop(),this.value=a(b,this.intervl)},b.prototype.stop=function(){angular.isDefined(this.value)&&(a.cancel(this.value),this.value=void 0)},b}]),angular.module("commonServices").factory("ServiceDelegator",["HL7V2MessageValidator","EDIMessageValidator","XMLMessageValidator","HL7V2MessageParser","EDIMessageParser","XMLMessageParser",function(a,b,c,d,e,f){return{getMessageValidator:function(d){if("hl7v2"===d)return a;if("xml"===d)return c;if("edi"===d)return b;throw new Error("Unsupported format "+d)},getMessageParser:function(a){if("hl7v2"===a)return d;if("xml"===a)return f;if("edi"===a)return e;throw new Error("Unsupported format "+a)}}}]),angular.module("commonServices").factory("TestCaseService",["$filter",function(a){var b=function(){};return b.prototype.findOneById=function(a,b){if(b){if(a===b.id)return b;if(b.children&&null!=b.children&&b.children.length>0)for(var c=0;c<b.children.length;c++){var d=this.findOneById(a,b.children[c]);if(null!=d)return d}}return null},b.prototype.findOneByIdAndType=function(a,b,c){if(c){if(a===c.id&&b===c.type)return c;if(c.children&&null!=c.children&&c.children.length>0)for(var d=0;d<c.children.length;d++){var e=this.findOneByIdAndType(a,b,c.children[d]);if(null!=e)return e}}return null},b.prototype.buildTree=function(b){"TestStep"===b.type?b.label=b.position+"."+b.name:b.label=b.name;var c=this;b.testCases&&(b.children?angular.forEach(b.testCases,function(a){b.children.push(a),c.buildTree(a)}):b.children=b.testCases,b.children=a("orderBy")(b.children,"position"),delete b.testCases),b.testCaseGroups&&(b.children?angular.forEach(b.testCaseGroups,function(a){b.children.push(a),c.buildTree(a)}):b.children=b.testCaseGroups,b.children=a("orderBy")(b.children,"position"),delete b.testCaseGroups),b.testSteps&&(b.children?angular.forEach(b.testSteps,function(a){b.children.push(a),c.buildTree(a)}):b.children=b.testSteps,b.children=a("orderBy")(b.children,"position"),delete b.testSteps),b.children&&angular.forEach(b.children,function(a){c.buildTree(a)})},b.prototype.findNode=function(a,b,c,d){if(b.id===c&&(void 0!=d&&b.type===d||!d&&!b.type))return b;var e=a.get_children(b);if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=this.findNode(a,e[f],c,d);if(null!=g)return g}return null},b.prototype.selectNodeByIdAndType=function(a,b,c){if(null!=b&&null!=a){var d=null,e=a.get_first_branch(),f=a.get_siblings(e);if(f&&f.length>0)for(var g=0;g<f.length;g++){var h=this.findNode(a,f[g],b,c);if(null!=h){d=h;break}}null!=d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}},b}]),angular.module("commonServices").factory("StorageService",["$rootScope","localStorageService",function(a,b){var c={CF_EDITOR_CONTENT_KEY:"CF_EDITOR_CONTENT",
CF_LOADED_TESTCASE_ID_KEY:"CF_LOADED_TESTCASE_ID",CF_LOADED_TESTCASE_TYPE_KEY:"CF_LOADED_TESTCASE_TYPE",CB_EDITOR_CONTENT_KEY:"CB_EDITOR_CONTENT",CB_SELECTED_TESTCASE_ID_KEY:"CB_SELECTED_TESTCASE_ID",CB_SELECTED_TESTCASE_TYPE_KEY:"CB_SELECTED_TESTCASE_TYPE",CB_LOADED_TESTCASE_ID_KEY:"CB_LOADED_TESTCASE_ID",CB_LOADED_TESTCASE_TYPE_KEY:"CB_LOADED_TESTCASE_TYPE",ISOLATED_EDITOR_CONTENT_KEY:"ISOLATED_EDITOR_CONTENT",ISOLATED_SELECTED_TESTCASE_ID_KEY:"ISOLATED_SELECTED_TESTCASE_ID",ISOLATED_LOADED_TESTCASE_ID_KEY:"ISOLATED_LOADED_TESTCASE_ID",ISOLATED_LOADED_TESTSTEP_ID_KEY:"ISOLATED_LOADED_TESTSTEP_ID",ISOLATED_LOADED_TESTSTEP_TYPE_KEY:"ISOLATED_LOADED_TESTSTEP_TYPE",ISOLATED_SELECTED_TESTCASE_TYPE_KEY:"ISOLATED_SELECTED_TESTCASE_TYPE",ISOLATED_LOADED_TESTCASE_TYPE_KEY:"ISOLATED_LOADED_TESTCASE_TYPE",ACTIVE_SUB_TAB_KEY:"ACTIVE_SUB_TAB",remove:function(a){return b.remove(a)},removeList:function(a,c,d){return b.remove(a,c,d)},clearAll:function(){return b.clearAll()},set:function(a,c){return b.set(a,c)},get:function(a){return b.get(a)}};return c}]),angular.module("hit-tool").controller("ValidationResultDetailsCtrl",["$scope","$modalInstance","selectedElement",function(a,b,c){a.selectedElement=c,a.ok=function(){b.close(a.selectedElement)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("cf").controller("CFTestingCtrl",["$scope","$http","CF","$window","$modal","$filter","$rootScope","CFTestCaseListLoader","$timeout","StorageService","TestCaseService",function(a,b,c,d,e,f,g,h,i,j,k){a.cf=c,a.loading=!1,a.error=null,a.testCases=[],a.testCase=null,a.tree={},a.tabs=new Array,a.error=null;var l=new k;a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0,0==a.activeTab&&a.$broadcast("cf:refreshEditor")},a.getTestCaseDisplayName=function(a){return a.parentName+" - "+a.label},a.selectTestCase=function(b){i(function(){if(b.testContext&&null!=b.testContext){c.testCase=b,a.testCase=c.testCase;var d=j.get(j.CF_LOADED_TESTCASE_ID_KEY);d!=b.id&&(j.set(j.CF_LOADED_TESTCASE_ID_KEY,b.id),j.remove(j.CF_EDITOR_CONTENT_KEY)),i(function(){g.$broadcast("cf:testCaseLoaded",a.testCase)}),i(function(){g.$broadcast("cf:profileLoaded",a.testCase.testContext.profile)}),i(function(){g.$broadcast("cf:valueSetLibraryLoaded",a.testCase.testContext.vocabularyLibrary)})}})},a.init=function(){j.remove(j.ACTIVE_SUB_TAB_KEY),a.error=null,a.loading=!0,a.testCases=[];var b=new h;b.then(function(b){angular.forEach(b,function(b){a.sortByPosition(b)}),a.testCases=f("orderBy")(b,"position"),a.tree.build_all(a.testCases);var c=null,d=j.get(j.CF_LOADED_TESTCASE_ID_KEY);if(null!=d)for(var e=0;e<a.testCases.length;e++){var g=l.findOneById(d,a.testCases[e]);if(null!=g){c=g;break}}null!=c&&(a.selectNode(c.id),a.selectTestCase(c)),a.loading=!1,a.error=null},function(b){a.error="Sorry,cannot load the profiles",a.loading=!1})},a.selectNode=function(b,c){i(function(){l.selectNodeByIdAndType(a.tree,b)},0)},a.sortByPosition=function(b){b.label=b.name,b.children&&(b.children=f("orderBy")(b.children,"position"),angular.forEach(b.children,function(b){a.sortByPosition(b)}))},a.openProfileInfo=function(){e.open({templateUrl:"CFProfileInfoCtrl.html",windowClass:"app-modal-window",controller:"CFProfileInfoCtrl"})},a.isSelectable=function(a){return a.testContext&&null!=a.testContext}}]),angular.module("cf").controller("CFProfileInfoCtrl",["$scope","$modalInstance",function(a,b){a.close=function(){b.dismiss("cancel")}}]),angular.module("cf").controller("CFProfileViewerCtrl",["$scope","CF","$rootScope",function(a,b,c){a.cf=b}]),angular.module("cf").controller("CFValidatorCtrl",["$scope","$http","CF","$window","HL7EditorUtils","HL7CursorUtils","$timeout","HL7TreeUtils","$modal","NewValidationResult","HL7Utils","$rootScope","ServiceDelegator","StorageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.validator=null,a.parser=null,a.cf=c,a.testCase=c.testCase,a.message=c.message,a.selectedMessage={},a.loading=!0,a.error=null,a.vError=null,a.vLoading=!0,a.mError=null,a.mLoading=!0,a.counter=0,a.type="cf",a.loadRate=4e3,a.tokenPromise=null,a.editorInit=!1,a.nodelay=!1,a.resized=!1,a.selectedItem=null,a.activeTab=0,a.tError=null,a.tLoading=!1,a.hasContent=function(){return""!=a.cf.message.content&&null!=a.cf.message.content},a.refreshEditor=function(){g(function(){a.editor.refresh()},1e3)},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/hl7/message/upload";c.submit().success(function(c,d,e){a.nodelay=!0;var f=angular.fromJson(c);a.cf.message.name=b,a.cf.editor.instance.doc.setValue(f.content),a.mError=null,a.execute()}).error(function(c,d,e){a.cf.message.name=b,a.mError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(a,b,c){})})}),a.loadMessage=function(){null!=a.cf.testCase.testContext.message&&(a.nodelay=!0,a.selectedMessage=a.cf.testCase.testContext.message,null!=a.selectedMessage&&null!=a.selectedMessage.content?a.editor.doc.setValue(a.selectedMessage.content):(a.editor.doc.setValue(""),a.cf.message.id=null,a.cf.message.name=""),a.execute())},a.setLoadRate=function(b){a.loadRate=b},a.initCodemirror=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("cfTextArea"),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",mode:"edi",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setSize("100%",345),a.editor.on("keyup",function(){g(function(){var b=a.editor.doc.getValue();a.error=null,a.tokenPromise&&(g.cancel(a.tokenPromise),a.tokenPromise=void 0),c.message.name=null,""!==b.trim()?a.tokenPromise=g(function(){a.execute()},a.loadRate):a.execute()})}),a.editor.on("dblclick",function(b){g(function(){var b=f.getCoordinate(a.editor);a.cf.cursor.init(b.line,b.startIndex,b.endIndex,b.index,!0),h.selectNodeByIndex(a.cf.tree.root,c.cursor,c.message.content)})}),a.cf.editor.instance=a.editor,a.refreshEditor()},a.validateMessage=function(){if(null!=a.validator)if(a.vLoading=!0,a.vError=null,null!=a.cf.testCase&&""!==a.cf.message.content)try{var b=a.cf.testCase.testContext.id,c=a.cf.message.content,d=(a.cf.testCase.label,a.validator.validate(b,c,"","Free"));d.then(function(b){a.vLoading=!1,a.loadValidationResult(b)},function(b){a.vLoading=!1,a.vError=b,a.loadValidationResult(null)})}catch(e){a.vLoading=!1,a.vError=e,a.loadValidationResult(null)}else a.loadValidationResult(null),a.vLoading=!1,a.vError=null;else a.vError="No validator found for the specified format "+a.cf.testCase!=null&&null!=a.cf.testCase.testContext?a.cf.testCase.testContext.format:""},a.loadValidationResult=function(a){g(function(){l.$broadcast("cf:validationResultLoaded",a)})},a.select=function(b){if(void 0!=b&&null!=b.path&&-1!=b.line){var c=h.selectNodeByPath(a.cf.tree.root,b.line,b.path),d=null!=c?c.data:null;a.cf.cursor.init(null!=d?d.lineNumber:b.line,null!=d?d.startIndex-1:b.column-1,null!=d?d.endIndex-1:b.column-1,null!=d?d.startIndex-1:b.column-1,!1),e.select(a.editor,a.cf.cursor)}},a.clearMessage=function(){a.nodelay=!0,a.mError=null,a.editor&&(a.editor.doc.setValue(""),a.execute())},a.saveMessage=function(){a.cf.message.download()},a.parseMessage=function(){if(null!=a.parser)if(a.tLoading=!0,null!=a.cf.testCase.testContext.profile&&""!=a.cf.message.content){var b=a.parser.parse(a.cf.testCase.testContext.id,a.cf.message.content);b.then(function(b){a.tLoading=!1,a.cf.tree.root.build_all(b)},function(b){a.tLoading=!1,a.tError=b})}else a.cf.tree.root.build_all([]),a.tError=null,a.tLoading=!1;else a.vError="No parser found for the specified format "+a.cf.testCase!=null&&null!=a.cf.testCase.testContext?a.cf.testCase.testContext.format:""},a.onNodeSelect=function(b){var c=h.getEndIndex(b,a.cf.message.content);a.cf.cursor.init(b.data.lineNumber,b.data.startIndex-1,c-1,b.data.startIndex-1,!1),e.select(a.editor,a.cf.cursor)},a.execute=function(){null!=a.cf.testCase&&(a.error=null,a.tError=null,a.mError=null,a.vError=null,a.cf.message.content=a.editor.doc.getValue(),n.set(n.CF_EDITOR_CONTENT_KEY,a.cf.message.content),a.validateMessage(),a.parseMessage())},a.init=function(){a.vLoading=!1,a.tLoading=!1,a.mLoading=!1,a.error=null,a.tError=null,a.mError=null,a.vError=null,a.initCodemirror(),a.$on("cf:refreshEditor",function(b){a.refreshEditor()}),l.$on("cf:testCaseLoaded",function(b,c){if(a.testCase=c,a.refreshEditor(),null!=a.testCase){var d=null==n.get(n.CF_EDITOR_CONTENT_KEY)?"":n.get(n.CF_EDITOR_CONTENT_KEY);a.nodelay=!0,a.mError=null;try{a.validator=m.getMessageValidator(a.testCase.testContext.format),a.parser=m.getMessageParser(a.testCase.testContext.format),a.editor&&(a.editor.doc.setValue(d),a.execute())}catch(e){a.mError=e,a.vError=e}}})}}]),angular.module("cf").controller("CFReportCtrl",["$scope","$sce","$http","CF",function(a,b,c,d){a.cf=d}]),angular.module("cf").controller("CFVocabularyCtrl",["$scope","CF",function(a,b){a.cf=b}]),angular.module("cb").controller("CBTestingCtrl",["$scope","$window","$rootScope","CB","StorageService",function(a,b,c,d,e){a.init=function(){var a=e.get(e.ACTIVE_SUB_TAB_KEY);(null==a||"/cb_execution"!=a)&&(a="/cb_testcase"),c.setSubActive(a)},a.getTestType=function(){return d.testCase.type},a.disabled=function(){return null==d.testCase||null===d.testCase.id}}]),angular.module("cb").controller("CBExecutionCtrl",["$scope","$window","$rootScope","$timeout",function(a,b,c,d){a.loading=!0,a.error=null,a.tabs=new Array,a.testCase=null,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0},a.getTestType=function(){return null!=a.testCase?a.testCase.type:""},a.init=function(){a.error=null,a.loading=!1,a.setActiveTab(0),c.$on("cb:testCaseLoaded",function(b,e,f){c.setSubActive(f&&null!=f?f:"/cb_execution"),a.testCase=e,d(function(){c.$broadcast("cb:profileLoaded",a.testCase.testContext.profile)}),d(function(){c.$broadcast("cb:valueSetLibraryLoaded",a.testCase.testContext.vocabularyLibrary)})})}}]),angular.module("cb").controller("CBTestCaseCtrl",["$scope","$window","$filter","$rootScope","CB","$timeout","CBTestCaseListLoader","$sce","StorageService","TestCaseService",function(a,b,c,d,e,f,g,h,i,j){a.selectedTestCase=e.selectedTestCase,a.testCase=e.testCase,a.testCases=[],a.tree={},a.loading=!0,a.error=null;var k=new j;a.init=function(){a.error=null,a.loading=!0;var b=new g;b.then(function(b){a.error=null,angular.forEach(b,function(a){k.buildTree(a)}),a.testCases=b,a.tree.build_all(a.testCases);var c=null,d=i.get(i.CB_SELECTED_TESTCASE_ID_KEY),e=i.get(i.CB_SELECTED_TESTCASE_TYPE_KEY);if(null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var g=k.findOneByIdAndType(d,e,a.testCases[f]);if(null!=g){c=g;break}}null!=c&&(a.selectTestCase(c),a.selectNode(d,e))}if(c=null,d=i.get(i.CB_LOADED_TESTCASE_ID_KEY),e=i.get(i.CB_LOADED_TESTCASE_TYPE_KEY),null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var g=k.findOneByIdAndType(d,e,a.testCases[f]);if(null!=g){c=g;break}}if(null!=c){var h=i.get(i.ACTIVE_SUB_TAB_KEY);a.loadTestCase(c,h)}}a.loading=!1},function(b){a.loading=!1,a.error="Sorry,cannot load the test cases. Please refresh your page and try again."})},a.refreshEditor=function(){f(function(){a.editor&&a.editor.refresh()},1e3)},a.isSelectable=function(a){return"TestCaseGroup"!==a.type},a.selectTestCase=function(b){(null==a.selectedTestCase||a.selectedTestCase.id!=b.id)&&(a.selectedTestCase=b,i.set(i.CB_SELECTED_TESTCASE_ID_KEY,b.id),i.set(i.CB_SELECTED_TESTCASE_TYPE_KEY,b.type),f(function(){d.$broadcast("cb:testCaseSelected",a.selectedTestCase)}))},a.selectNode=function(b,c){f(function(){k.selectNodeByIdAndType(a.tree,b,c)},0)},a.selectTestPlan=function(b){(null==a.selectedTestCase||a.selectedTestCase.id!=b.id)&&(a.selectedTestCase=b)},a.loadTestCase=function(b,c){f(function(){if("TestStep"===b.type){e.testCase=b,a.testCase=e.testCase;var g=i.get(i.CB_LOADED_TESTCASE_ID_KEY),h=i.get(i.CB_LOADED_TESTCASE_TYPE_KEY);(g!=a.testCase.id||h!=a.testCase.type)&&(i.set(i.CB_LOADED_TESTCASE_ID_KEY,a.testCase.id),i.set(i.CB_LOADED_TESTCASE_TYPE_KEY,a.testCase.type),i.remove(i.CB_EDITOR_CONTENT_KEY)),f(function(){d.$broadcast("cb:testCaseLoaded",a.testCase,c)})}})},a.expand=function(a){}}]),angular.module("cb").controller("CBProfileViewerCtrl",["$scope","CB",function(a,b){a.cb=b}]),angular.module("cb").controller("CBValidatorCtrl",["$scope","$http","CB","$window","HL7EditorUtils","HL7CursorUtils","$timeout","HL7TreeUtils","$modal","NewValidationResult","$rootScope","ServiceDelegator","StorageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.cb=c,a.testCase=c.testCase,a.message=c.message,a.selectedMessage={},a.loading=!0,a.error=null,a.vError=null,a.vLoading=!0,a.mError=null,a.mLoading=!0,a.validator=null,a.counter=0,a.type="cb",a.loadRate=4e3,a.tokenPromise=null,a.editorInit=!1,a.nodelay=!1,a.resized=!1,a.selectedItem=null,a.activeTab=0,a.messageObject=[],a.tError=null,a.tLoading=!1,a.hasContent=function(){return""!=a.cb.message.content&&null!=a.cb.message.content},a.refreshEditor=function(){g(function(){a.editor.refresh()},1e3)},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/hl7/message/upload";c.submit().success(function(c,d,e){a.nodelay=!0;var f=angular.fromJson(c);a.cb.message.name=b,a.cb.editor.instance.doc.setValue(f.content),a.mError=null,a.execute()}).error(function(c,d,e){a.cb.message.name=b,a.mError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(a,b,c){})})}),a.loadMessage=function(){var b=a.cb.testCase,c=b.testContext,d=a.cb.testCase.testContext.message,e=d?d.content:null;null!=c.message&&null!=e&&""!=e&&(a.nodelay=!0,a.selectedMessage=a.cb.testCase.testContext.message,null!=a.selectedMessage&&null!=a.selectedMessage.content?a.editor.doc.setValue(a.selectedMessage.content):(a.editor.doc.setValue(""),a.cb.message.id=null,a.cb.message.name=""),a.execute())},a.setLoadRate=function(b){a.loadRate=b},a.initCodemirror=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("cb-textarea"),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",mode:"edi",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setSize("100%",345),a.editor.on("keyup",function(){g(function(){var b=a.editor.doc.getValue();a.error=null,a.tokenPromise&&(g.cancel(a.tokenPromise),a.tokenPromise=void 0),c.message.name=null,""!==b.trim()?a.tokenPromise=g(function(){a.execute()},a.loadRate):a.execute()})}),a.editor.on("dblclick",function(b){g(function(){var b=f.getCoordinate(a.editor);a.cb.cursor.init(b.line,b.startIndex,b.endIndex,b.index,!0),h.selectNodeByIndex(a.cb.tree.root,c.cursor,c.message.content)})}),a.cb.editor.instance=a.editor,a.refreshEditor()},a.validateMessage=function(){if(null!=a.validator)if(a.vLoading=!0,a.vError=null,null!=a.cb.testCase&&""!==a.cb.message.content)try{var b=a.validator.validate(a.cb.testCase.testContext.id,a.cb.message.content,a.cb.testCase.label,"Based");b.then(function(b){a.vLoading=!1,a.loadValidationResult(b)},function(b){a.vLoading=!1,a.vError=b,a.loadValidationResult(null)})}catch(c){a.vLoading=!1,a.vError=c,a.loadValidationResult(null)}else a.loadValidationResult(null),a.vLoading=!1,a.vError=null;else a.vError="No validator found for the specified format "+a.cb.testCase!=null&&null!=a.cb.testCase.testContext?a.cb.testCase.testContext.format:""},a.loadValidationResult=function(a){g(function(){k.$broadcast("cb:validationResultLoaded",a)})},a.select=function(b){if(void 0!=b&&null!=b.path&&-1!=b.line){var c=h.selectNodeByPath(a.cb.tree.root,b.line,b.path),d=null!=c?c.data:null;a.cb.cursor.init(null!=d?d.lineNumber:b.line,null!=d?d.startIndex-1:b.column-1,null!=d?d.endIndex-1:b.column-1,null!=d?d.startIndex-1:b.column-1,!1),e.select(a.editor,a.cb.cursor)}},a.clearMessage=function(){a.nodelay=!0,a.mError=null,a.editor&&(a.editor.doc.setValue(""),a.execute())},a.saveMessage=function(){a.cb.message.download()},a.parseMessage=function(){if(null!=a.parser)if(a.tLoading=!0,null!=a.cb.testCase&&""!=a.cb.message.content){var b=a.parser.parse(a.cb.testCase.testContext.id,a.cb.message.content,a.cb.testCase.label);b.then(function(b){a.tLoading=!1,a.cb.tree.root.build_all(b)},function(b){a.tLoading=!1,a.tError=b})}else a.cb.tree.root.build_all([]),a.tError=null,a.tLoading=!1;else a.tError="No parser found for the specified format "+a.cb.testCase!=null&&null!=a.cb.testCase.testContext?a.cb.testCase.testContext.format:""},a.onNodeSelect=function(b){var c=h.getEndIndex(b,a.cb.message.content);a.cb.cursor.init(b.data.lineNumber,b.data.startIndex-1,c-1,b.data.startIndex-1,!1),e.select(a.editor,a.cb.cursor)},a.execute=function(){a.error=null,a.tError=null,a.mError=null,a.vError=null,a.cb.message.content=a.editor.doc.getValue(),m.set(m.CB_EDITOR_CONTENT_KEY,a.cb.message.content),a.validateMessage(),a.parseMessage()},a.init=function(){a.vLoading=!1,a.tLoading=!1,a.mLoading=!1,a.error=null,a.tError=null,a.mError=null,a.vError=null,a.initCodemirror(),a.loadValidationResult(null),a.$on("cb:refreshEditor",function(b){a.refreshEditor()}),k.$on("cb:testCaseLoaded",function(b,c){if(a.refreshEditor(),a.testCase=c,null!=a.testCase){var d=null==m.get(m.CB_EDITOR_CONTENT_KEY)?"":m.get(m.CB_EDITOR_CONTENT_KEY);a.nodelay=!0,a.mError=null;try{a.validator=l.getMessageValidator(a.testCase.testContext.format),a.parser=l.getMessageParser(a.testCase.testContext.format),a.editor&&(a.editor.doc.setValue(d),a.execute())}catch(e){a.mError=e,a.vError=e}}})}}]),angular.module("cb").controller("CBReportCtrl",["$scope","$sce","$http","CB",function(a,b,c,d){a.cb=d}]),angular.module("cb").controller("CBVocabularyCtrl",["$scope","CB",function(a,b){a.cb=b}]),angular.module("hit-tool").controller("ContactCtrl",["$scope","ContactLoader","ContactListLoader",function(a,b,c){a.init=function(){var b=new c;return b.then(function(b){a.contacts=b},function(b){a.error=b}),b}}]),angular.module("hit-tool").controller("AboutCtrl",["$scope","AppInfo",function(a,b){}]),angular.module("hit-tool-directives").directive("hl7editor",["$timeout",function(a){return{restrict:"A",link:function(a,b,c){a.editor=CodeMirror.fromTextArea(document.getElementById(c.id),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",mode:"edi",readOnly:void 0!=c.readonly&&c.readonly,showCursorWhenSelecting:!0}),a.editor.setSize(null,300),a.editor.on("change",function(b){a.$emit(c.type+":editor:update")}),a.editor.on("dblclick",function(b){a.$emit(c.type+":editor:dblclick")}),a.editorInit=!0}}}]),angular.module("hit-tool-directives").directive("soapEditor",["$timeout",function(a){return{restrict:"A",link:function(a,b,c){a.editor=CodeMirror.fromTextArea(document.getElementById(c.id),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:void 0!=c.readonly&&c.readonly,showCursorWhenSelecting:!0}),a.editor.setSize(null,300),a.editor.on("dblclick",function(b){a.$emit(c.type+":editor:dblclick")}),a.editorInit=!0}}}]),angular.module("hit-tool-directives").directive("mypopover",["$compile","$templateCache",function(a,b){return{restrict:"A",link:function(a,c,d){var e=b.get("profileInfo.html"),f={content:e,placement:"bottom",html:!0};$(c).popover(f)}}}]);